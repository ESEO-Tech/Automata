namespace("automata.games.openTheGate",function(a){"use strict";a.World=automata.model.World.create({timeStepMax:100,sensors:[{name:"B",desc:"Button"},{name:"O",desc:"Gate is fully Open"},{name:"C",desc:"Gate is fully Closed"},{name:"V",desc:"A Vehicle is passing through the gate"}],actuators:[{name:"U",desc:"Move gate Up"},{name:"D",desc:"Move gate Down"}],gateWidth:10,gateYMin:150,gateYMax:210,gateYOpen:170,gateYStep:1,gateX:250,carWidth:80,carXMin:[-80,-480,-880,-1280],carXMax:421,carXStop:120,carXStep:2,carY:190,carCount:4,width:400,height:300,onReset:function(){this.gateY=this.gateYMax,this.carX=this.carXMin.slice(),this.buttonHasBeenPressed=!1,this.gateOpeningBeforeButtonPressed=!1,this.carsPassed=0,this.gateForcedOpen=!1,this.gateForcedClosed=!1,this.upAndDownAtTheSameTime=!1,this.crush=!1},onStep:function(){"1"===this.getActuatorValue(0)&&"1"===this.getActuatorValue(1)?this.upAndDownAtTheSameTime=!0:"1"===this.getActuatorValue(0)?(this.buttonHasBeenPressed||(this.gateOpeningBeforeButtonPressed=!0),this.gateY>this.gateYMin?this.gateY-=this.gateYStep:this.gateForcedOpen=!0):"1"===this.getActuatorValue(1)&&(this.gateY<this.gateYMax&&!this.crush?(this.gateY+=this.gateYStep,this.gateY>=this.gateYOpen&&(this.buttonHasBeenPressed=!1)):this.gateForcedClosed=!0),this.setSensorValue(1,this.gateY<=this.gateYMin?"1":"0"),this.setSensorValue(2,this.gateY>=this.gateYMax?"1":"0"),this.setSensorValue(0,"0"),this.setSensorValue(3,"0");for(var a=!0,b=0;b<this.carX.length;b++){var c=this.carX[b];a&&(c>=this.carXStop&&c<this.gateX+this.gateWidth&&this.gateY>=this.gateYOpen?a=!1:c<this.carXMax&&(this.carX[b]=c+=this.carXStep,c>=this.carXMax&&this.carsPassed++)),c>=this.carXStop&&c<=this.carXStop+this.carXStep&&this.gateY>=this.gateYOpen&&(this.setSensorValue(0,"1"),this.buttonHasBeenPressed=!0),c>=this.gateX-this.carWidth&&c<=this.gateX+this.gateWidth&&this.gateY>this.gateYOpen&&(this.crush=!0),c+this.carWidth>=this.gateX&&c<=this.gateX+this.gateWidth&&this.setSensorValue(3,"1")}},problem:function(){return this.gateOpeningBeforeButtonPressed||this.gateForcedOpen||this.gateForcedClosed||this.upAndDownAtTheSameTime||this.crush},getStatus:function(){return this.crush?{done:!0,status:"error",message:"Do not close the gate when a car is passing through."}:this.gateOpeningBeforeButtonPressed?{done:!0,status:"error",message:"The gate started opening before the button was pressed."}:this.carsPassed===this.carCount?this.upAndDownAtTheSameTime?{done:!0,status:"warning",message:"Up and Down commands must not be active at the same time."}:this.gateForcedOpen?{done:!0,status:"warning",message:"Turn the Up command off when the gate is open."}:this.gateForcedClosed?{done:!0,status:"warning",message:"Turn the Down command off when the gate is closed."}:{done:!0,status:"success"}:{done:!1}}})}),namespace("automata.games.openTheGate",function(a){"use strict";a.WorldView=automata.model.Object.create({init:function(a,b){function c(a,b){return a.group(a.path("m10,50 l60,0 c5,0 10,-5 10,-10 0,-10 -40,-20 -60,-20 -15,0 -20,10 -20,20 0,5 5,10 10,10 z").attr({fill:b}),a.path("m40,35 c10,0 20,0 20,-5 0,-2 -15,-7 -25,-7 -5,0 0,10 5,12 z").attr({fill:"rgb(54,84,110)"}),a.circle(20,50,7).attr({fill:"grey",stroke:"black",strokeWidth:4}),a.circle(60,50,7).attr({fill:"grey",stroke:"black",strokeWidth:4}))}return automata.model.Object.init.call(this),this.world=a,this.paper=Snap(),b.append(this.paper.node),this.paper.attr({viewBox:"0 0 "+a.width+" "+a.height,preserveAspectRatio:"xMidYMid meet"}),this.paper.node.setAttribute("preserveAspectRatio","xMidYMid meet"),this.paper.rect(0,250,420,300).attr({fill:"grey"}),this.paper.rect(240,0,30,150).attr({fill:"grey"}),this.sensorViews=[this.paper.circle(180,170,5),this.paper.rect(245,144,20,5),this.paper.rect(245,251,20,5),this.paper.rect(270,251,20,5)],this.paper.text(180,160,"B"),this.paper.text(255,140,"O"),this.paper.text(255,270,"C"),this.paper.text(280,270,"V"),this.carViews=[c(this.paper,"rgb(255,114,255)"),c(this.paper,"rgb(114,197,9)"),c(this.paper,"rgb(100,170,220)"),c(this.paper,"rgb(255,200,0)")],this.actuatorViews=new Array(2),this.gateView=this.paper.group(this.paper.rect(0,0,10,40).attr({fill:"white",stroke:"none"}),this.paper.path("m0,0 l10,0 -10,10 0,-10 z").attr({fill:"red"}),this.paper.path("m10,10 l0,10 -10,10 0,-10 z").attr({fill:"red"}),this.paper.path("m10,30 l0,10 -10,0 z").attr({fill:"red"}),this.paper.rect(0,0,10,40).attr({fill:"none",stroke:"black"}),this.actuatorViews[0]=this.paper.path("m25,20 l6,6 -3,0 0,6 -6,0 0,-6 -3,0 z"),this.paper.text(25,15,"U"),this.actuatorViews[1]=this.paper.path("m50,32 l6,-6 -3,0 0,-6 -6,0 0,6 -3,0 z"),this.paper.text(50,15,"D")),this.problemView=this.paper.group(this.paper.path("m0,0 l10,5 5,-10 5,10 10,-5 -5,10 5,10 -10,-5 -5,10 -5,-10 -10,5 5,-10 z").attr({fill:"yellow",stroke:"black"}),this.paper.text(15,15,"!")).attr({transform:"translate(275,130)"}),this.paper.rect(-80,0,80,300).attr({fill:"white"}),this.paper.rect(420,0,500,300).attr({fill:"white"}),this.update(),a.addListener("changed",this.update,this),this},update:function(){for(var a=0;a<this.sensorViews.length;a++)this.sensorViews[a].attr({"class":"1"===this.world.sensorValues[a]?"active":"inactive"});for(var b=0;b<this.actuatorViews.length;b++)this.actuatorViews[b].attr({"class":"1"===this.world.actuatorValues[b]?"active":"inactive"});for(var c=0;c<this.carViews.length;c++)this.carViews[c].attr({transform:"translate("+this.world.carX[c]+","+this.world.carY+")"});this.gateView.attr({transform:"translate("+this.world.gateX+","+this.world.gateY+")"}),this.problemView.attr({"class":this.world.problem()?"visible":"invisible"})}})}),namespace("automata.games.openTheGate",function(a){"use strict";a.DontCrushTheFollowerWorld=a.World.create({carXMin:[-80,-190,-500,-690],getStatus:function(){var b=a.World.getStatus.call(this);return b.done&&("success"===b.status||"warning"===b.status)&&this.gateY<this.gateYMax?{done:!0,status:"error",message:"The gate is still open. Close it behind you."}:b}})}),namespace("automata.games.openTheGate",function(a){"use strict";a.DontCrushTheFollower={key:"automata.games.openTheGate.DontCrushTheFollower",view:a.WorldView,world:a.DontCrushTheFollowerWorld}});